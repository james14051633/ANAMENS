<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ficha Dinâmica - Denver II, Checklist e COPM</title>
<style>
  /* Seu CSS animado e estiloso */
  body {
    font-family: 'Roboto', sans-serif;
    background: linear-gradient(270deg, #6a11cb, #2575fc, #6a11cb);
    background-size: 600% 600%;
    animation: gradientShift 30s ease infinite;
    color: #333;
    min-height: 100vh;
    padding: 20px;
    display: flex;
    justify-content: center;
  }
  @keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  .container {
    background: white;
    padding: 30px;
    border-radius: 12px;
    max-width: 900px;
    width: 100%;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
  }
  h1 {
    text-align: center;
    color: #4a3fbd;
    margin-bottom: 20px;
    font-family: 'Montserrat', sans-serif;
  }
  label {
    display: block;
    margin-top: 15px;
    font-weight: 600;
  }
  select,
  input[type="text"],
  input[type="date"],
  input[type="number"],
  textarea {
    width: 100%;
    padding: 12px;
    margin-top: 5px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 16px;
    resize: vertical;
  }
  input.invalid,
  textarea.invalid,
  select.invalid {
    border-color: #e53935;
    background-color: #ffebee;
  }
  button {
    margin-top: 25px;
    background-color: #4a3fbd;
    color: white;
    border: none;
    padding: 15px;
    font-size: 18px;
    border-radius: 8px;
    cursor: pointer;
    width: 100%;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #362f8a;
  }
  /* Resultados COPM */
  #result {
    margin-top: 20px;
    padding: 15px;
    border: 1px solid #ccc;
    background: #f9f9f9;
    display: none;
  }
  /* Espaçamento entre grupos COPM */
  #form-content > div {
    margin-bottom: 15px;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>Ficha Dinâmica - Denver II, Checklist e COPM</h1>

    <label for="modelo">Selecione o modelo de ficha:</label>
    <select id="modelo" aria-label="Selecione o modelo de ficha">
      <option value="">-- Selecione --</option>
      <option value="denver_ii">Denver II</option>
      <option value="checklist_denver">Checklist Denver</option>
      <option value="copm">COPM</option>
    </select>

    <!-- Formulário padrão (Denver II e Checklist) -->
    <form id="ficha-form" style="display:none" novalidate>
      <div id="form-content"></div>
      <button type="submit">Salvar</button>
    </form>

    <!-- Botão para limpar dados -->
    <button id="limpar-btn" style="display:none;">Limpar Dados</button>
  </div>

<script>
  const modelos = {
    denver_ii: [
      { label: 'Nome da criança', type: 'text', name: 'nome_crianca', required: true },
      { label: 'Data de nascimento', type: 'date', name: 'data_nascimento', required: true },
      { label: 'Idade (anos, meses, dias)', type: 'text', name: 'idade', required: true },
      { label: 'Data do teste', type: 'date', name: 'data_teste', required: true },
      { label: 'Nome do avaliador', type: 'text', name: 'avaliador', required: true },
      { label: 'Responsável presente', type: 'text', name: 'responsavel', required: false },
      { label: 'Olha para o rosto', type: 'select', name: 'olha_rosto', required: true, options: ['Passou', 'Falhou', 'Sem oportunidade', 'Recusou'] },
      { label: 'Sorri em resposta', type: 'select', name: 'sorri_resposta', required: true, options: ['Passou', 'Falhou', 'Sem oportunidade', 'Recusou'] },
      { label: 'Observações gerais', type: 'textarea', name: 'observacoes' },
      { label: 'Interpretação do teste', type: 'select', name: 'interpretacao', required: true, options: ['Normal', 'Questionável', 'Não aplicável'] }
    ],
    checklist_denver: [
      { label: 'Nome da criança', type: 'text', name: 'nome_crianca', required: true },
      { label: 'Data de nascimento', type: 'date', name: 'data_nascimento', required: true },
      { label: 'Idade (anos, meses, dias)', type: 'text', name: 'idade', required: true },
      { label: 'Data do teste', type: 'date', name: 'data_teste', required: true },
      { label: 'Nome do avaliador', type: 'text', name: 'avaliador', required: true },
      { label: 'Responsável presente', type: 'text', name: 'responsavel', required: false },
      { label: 'Olha para o rosto', type: 'select', name: 'olha_rosto', required: true, options: ['Passou', 'Falhou', 'Sem oportunidade', 'Recusou'] },
      { label: 'Sorri em resposta', type: 'select', name: 'sorri_resposta', required: true, options: ['Passou', 'Falhou', 'Sem oportunidade', 'Recusou'] },
      { label: 'Observações gerais', type: 'textarea', name: 'observacoes' },
      { label: 'Interpretação do teste', type: 'select', name: 'interpretacao', required: true, options: ['Normal', 'Questionável', 'Não aplicável'] }
    ],
    copm: [
      {
        category: "Cuidados Pessoais",
        questions: [
          "Escolha uma atividade importante para você relacionada a cuidados pessoais",
          "Avalie seu desempenho nessa atividade (1 a 10)",
          "Avalie sua satisfação com seu desempenho nessa atividade (1 a 10)"
        ]
      },
      {
        category: "Lazer",
        questions: [
          "Escolha uma atividade importante para você relacionada a lazer",
          "Avalie seu desempenho nessa atividade (1 a 10)",
          "Avalie sua satisfação com seu desempenho nessa atividade (1 a 10)"
        ]
      },
      {
        category: "Trabalho",
        questions: [
          "Escolha uma atividade importante para você relacionada ao trabalho",
          "Avalie seu desempenho nessa atividade (1 a 10)",
          "Avalie sua satisfação com seu desempenho nessa atividade (1 a 10)"
        ]
      }
    ]
  };

  function createCOPMForm(containerId) {
    const container = document.getElementById(containerId);
    if (!container) {
      console.error(`Elemento com id "${containerId}" não encontrado.`);
      return;
    }

    container.innerHTML = '';

    const form = document.createElement("form");
    form.id = "copmForm";

    modelos.copm.forEach((section, i) => {
      const sectionDiv = document.createElement("div");
      sectionDiv.style.border = "1px solid #ddd";
      sectionDiv.style.padding = "10px";
      sectionDiv.style.marginBottom = "15px";

      const title = document.createElement("h2");
      title.textContent = section.category;
      sectionDiv.appendChild(title);

      // Pergunta 1 - texto
      const q1Label = document.createElement("label");
      q1Label.setAttribute("for", `activity_${i}`);
      q1Label.textContent = section.questions[0];
      sectionDiv.appendChild(q1Label);

      const q1Input = document.createElement("input");
      q1Input.type = "text";
      q1Input.id = `activity_${i}`;
      q1Input.name = `activity_${i}`;
      q1Input.required = true;
      sectionDiv.appendChild(q1Input);

      // Pergunta 2 - número
      const q2Label = document.createElement("label");
      q2Label.setAttribute("for", `performance_${i}`);
      q2Label.textContent = section.questions[1];
      sectionDiv.appendChild(q2Label);

      const q2Input = document.createElement("input");
      q2Input.type = "number";
      q2Input.id = `performance_${i}`;
      q2Input.name = `performance_${i}`;
      q2Input.min = 1;
      q2Input.max = 10;
      q2Input.required = true;
      sectionDiv.appendChild(q2Input);

      // Pergunta 3 - número
      const q3Label = document.createElement("label");
      q3Label.setAttribute("for", `satisfaction_${i}`);
      q3Label.textContent = section.questions[2];
      sectionDiv.appendChild(q3Label);

      const q3Input = document.createElement("input");
      q3Input.type = "number";
      q3Input.id = `satisfaction_${i}`;
      q3Input.name = `satisfaction_${i}`;
      q3Input.min = 1;
      q3Input.max = 10;
      q3Input.required = true;
      sectionDiv.appendChild(q3Input);

      form.appendChild(sectionDiv);
    });

    const submitBtn = document.createElement("button");
    submitBtn.type = "submit";
    submitBtn.textContent = "Enviar";
    form.appendChild(submitBtn);

    const resultDiv = document.createElement("div");
    resultDiv.id = "result";
    resultDiv.style.marginTop = "20px";
    resultDiv.style.padding = "15px";
    resultDiv.style.border = "1px solid #ccc";
    resultDiv.style.background = "#f9f9f9";
    resultDiv.style.display = "none";

    container.appendChild(form);
    container.appendChild(resultDiv);

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      let valid = true;
      const errors = [];

      modelos.copm.forEach((section, i) => {
        const activity = form[`activity_${i}`].value.trim();
        const performance = Number(form[`performance_${i}`].value);
        const satisfaction = Number(form[`satisfaction_${i}`].value);

        if (!activity) {
          valid = false;
          errors.push(`Atividade em "${section.category}" é obrigatória.`);
        }
        if (!(performance >= 1 && performance <= 10)) {
          valid = false;
          errors.push(`Desempenho em "${section.category}" deve ser entre 1 e 10.`);
        }
        if (!(satisfaction >= 1 && satisfaction <= 10)) {
          valid = false;
          errors.push(`Satisfação em "${section.category}" deve ser entre 1 e 10.`);
        }
      });

      if (!valid) {
        resultDiv.style.display = "block";
        resultDiv.style.color = "red";
        resultDiv.innerHTML = errors.map(e => `<p>${e}</p>`).join("");
        return;
      }

      let output = "<h3>Resultados da Ficha COPM:</h3>";
      modelos.copm.forEach((section, i) => {
        output += `<h4>${section.category}</h4>`;
        output += `<p><strong>Atividade:</strong> ${form[`activity_${i}`].value}</p>`;
        output += `<p><strong>Desempenho:</strong> ${form[`performance_${i}`].value}</p>`;
        output += `<p><strong>Satisfação:</strong> ${form[`satisfaction_${i}`].value}</p>`;
      });

      resultDiv.style.display = "block";
      resultDiv.style.color = "black";
      resultDiv.innerHTML = output;
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    const modeloSelect = document.getElementById('modelo');
    const form = document.getElementById('ficha-form');
    const formContent = document.getElementById('form-content');
    const limparBtn = document.getElementById('limpar-btn');

    modeloSelect.addEventListener('change', () => {
      const modelo = modeloSelect.value;
      formContent.innerHTML = '';
      if (!modelo || !modelos[modelo]) {
        form.style.display = 'none';
        limparBtn.style.display = 'none';
        return;
      }

      if(modelo === 'copm') {
        form.style.display = 'none';
        limparBtn.style.display = 'inline-block';
        createCOPMForm('form-content');
        return;
      }

      form.style.display = 'block';
      limparBtn.style.display = 'inline-block';

      modelos[modelo].forEach(campo => {
        const label = document.createElement('label');
        label.htmlFor = campo.name;
        label.textContent = campo.label + (campo.required ? '*' : '');
        formContent.appendChild(label);

        let input;
        if (campo.type === 'textarea') {
          input = document.createElement('textarea');
          input.rows = 4;
        } else if (campo.type === 'select') {
          input = document.createElement('select');
          campo.options.forEach(opt => {
            const option = document.createElement('option');
            option.value = opt;
            option.textContent = opt;
            input.appendChild(option);
          });
        } else {
          input = document.createElement('input');
          input.type = campo.type;
          if (campo.min !== undefined) input.min = campo.min;
          if (campo.max !== undefined) input.max = campo.max;
        }
        input.name = campo.name;
        input.id = campo.name;
        if (campo.required) input.required = true;
        formContent.appendChild(input);
      });

      carregarDados(modelo);
    });

    function salvarDados(modelo) {
      const dados = {};
      modelos[modelo].forEach(campo => {
        const el = document.getElementById(campo.name);
        if (el) dados[campo.name] = el.value;
      });
      localStorage.setItem('ficha_' + modelo, JSON.stringify(dados));
    }

    function carregarDados(modelo) {
      const dadosSalvos = localStorage.getItem('ficha_' + modelo);
      if (!dadosSalvos) return;
      const dados = JSON.parse(dadosSalvos);
      modelos[modelo].forEach(campo => {
        const el = document.getElementById(campo.name);
        if (el && dados[campo.name]) el.value = dados[campo.name];
      });
    }

    limparBtn.addEventListener('click', () => {
      const modelo = modeloSelect.value;
      if (!modelo) return;
      localStorage.removeItem('ficha_' + modelo);
      modelos[modelo].forEach(campo => {
        const el = document.getElementById(campo.name);
        if (el) el.value = '';
      });
      alert('Dados limpos!');
    });

    form.addEventListener('submit', e => {
      e.preventDefault();
      const modelo = modeloSelect.value;
      if (!modelo) {
        alert('Selecione um modelo de ficha.');
        return;
      }

      let valido = true;
      let mensagensErro = [];

      modelos[modelo].forEach(campo => {
        const el = document.getElementById(campo.name);
        if (campo.required && el) {
          if (!el.value.trim()) {
            el.classList.add('invalid');
            valido = false;
            mensagensErro.push(`O campo "${campo.label}" é obrigatório.`);
          } else {
            el.classList.remove('invalid');
          }
        }
        if (campo.type === 'number' && el && el.value) {
          const valor = Number(el.value);
          if (campo.min !== undefined && valor < campo.min) {
            el.classList.add('invalid');
            valido = false;
            mensagensErro.push(`O campo "${campo.label}" deve ser maior ou igual a ${campo.min}.`);
          }
          if (campo.max !== undefined && valor > campo.max) {
            el.classList.add('invalid');
            valido = false;
            mensagensErro.push(`O campo "${campo.label}" deve ser menor ou igual a ${campo.max}.`);
          }
        }
      });

      if (!valido) {
        alert(mensagensErro.join('\n'));
        return;
      }

      salvarDados(modelo);
      alert('Dados salvos com sucesso!');
    });
  });
</script>
</body>
</html>
